%YAML 1.2
# vim:ts=2:sw=2:sts=2:et:
---
default:
  dep: [secrets, remote-access, graphical, systemd-units, root]
  pkg: [tmux, xclip, sxhkd]
  snippets:
    git-pre: &git-pre |
      git clone --depth 1 "$url" tmp
      cd tmp
    git-post: &git-post |
      cd ..
      rm -rf tmp
  cmd: |
    echo "TODO:"
    echo "set (same) x11vnc password"
    echo "compare \$(apt list --installed | sed -e 's/\/.*//g\)'"
    echo relogin
    echo vim correctly
    echo log in to chrome, lastpass, spotify, mega, dropbox...
secrets:
  cmd: |
    git clone --bare https://github.com/aljoschua/secrets .config/secrets
    dot="git --git-dir=$HOME/.config/secrets --work-tree=$HOME"
    $dot co @ -- .config/secrets
    $dot stash
    $dot co
root:
  cmd: |
    sudo su -c "
    cd
    git clone --bare -b root hub:aljoschua/dotfiles .config/dotfiles
    dot='git --git-dir=\$HOME/.config --work-tree=\$HOME'
    $dot checkout @ -- /root/.config/dotfiles
    $dot -c user.name=a -c user.email=a stash
    ln -s ~$USER ~/.portal"
graphical:
  dep: [libinput-gestures, spotify, dmenu]
  pkg: [x11vnc, remmina, remmina-plugin-vnc, kdeconnect, i3]
  cmd: |
    sudo usermod -aG video $USER
    sudo usermod -aG plugdev $USER # are these needed? where to put them?
dmenu:
  cmd:
    - 'url=sl:dmenu'
    - *git-pre
    - sudo make clean install
    - *git-post
remote-access: {pkg: [openssh-server]}
systemd-units:
  cmd: |
    systemctl --user enable ~/.config/systemd/user/*
libinput-gestures:
  pkg: [xdotool, wmctrl, libinput-tools, zenity]
  cmd:
    - url=hub:bulletmark/libinput-gestures
    - *git-pre
    - sudo make install
    - *git-post
    - |
      sudo usermod -aG input $user
      sudo ln -sf "${XDG_CONFIG_HOME:-$HOME/.config}/libinput-gestures/running.conf" "/etc/libinput-gestures.conf"
      libinput-gestures-setup autostart
scrcpy:
  pkg: [ffmpeg, libsdl2-2.0-0, adb, gcc, pkg-config, meson, ninja-build, libavcodec-dev, libavformat-dev, libavutil-dev, libsdl2-dev]
  cmd:
    - pip3 install meson
    - url=hub:Genymobile/scrcpy
    - *git-pre
    - |
      wget -0 https://github.com/Genymobile/scrcpy/releases/download/v1.14/scrcpy-server-v1.14 server # Needs testing
      meson x --buildtype release --strip -Db_lto=true -Dprebuilt_server=server
      ninja -Cx
      sudo ninja -Cx install
    - *git-post
tub: {pkg: [kinit, kstart]}
spotify:
  pkg: [spotify-client]
  cmd: |
    sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 4774BD5E130D1D45
vim:
  pkg: [libncurses5-dev, libncursesw5-dev]
  cmd: [mkdir ~/.vim/undo-history]
...

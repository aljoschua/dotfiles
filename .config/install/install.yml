%YAML 1.2
# vim:ts=2:sw=2:sts=2:et:
---
default:
  dep: [secrets, remote-access, graphical, systemd-units, root]
  pkg: [tmux, xclip, sxhkd, neovim, zsh]
  snippets:
    git-pre: &git-pre |-
      git clone --depth 1 "$url" tmp
      cd tmp
    git-post: &git-post |-
      cd ..
      rm -rf tmp
  cmd: |-
    sudo chsh -s /usr/bin/zsh
    echo "TODO:"
    echo "set (same) x11vnc password"
    echo "compare \$(apt-mark showmanual | sed -e 's/\/.*//g\)'" # could diff > file
    echo relogin
    echo log in to chrome, lastpass, spotify, mega, dropbox...
    echo sudo update-alternatives --config x-window-manager
secrets:
  cmd: |-
    git clone --bare https://aljoschua${GITHUB_PAT}@github.com/aljoschua/secrets .config/secrets
    dot() { git --git-dir=$HOME/.config/secrets --work-tree=$HOME "$@"; }
    dot co @ -- .config/secrets
    dot stash
    dot co
root:
  cmd: |-
    sudo su -c "set -e
    cd
    git clone --bare -b root ~$USER/.config/dotfiles .config/dotfiles
    git --git-dir=\$HOME/.config/dotfiles --work-tree=/ checkout @ -- /root/.config/dotfiles
    git --git-dir=\$HOME/.config/dotfiles --work-tree=/ -c user.name=a -c user.email=a stash
    ln -s ~$USER ~/.portal
    git clone --bare -b root ~$USER/.config/secrets .config/secrets
    git --git-dir=\$HOME/.config/secrets --work-tree=/ co @ -- /root/.config/secrets
    git --git-dir=\$HOME/.config/secrets --work-tree=/ stash
    git --git-dir=\$HOME/.config/secrets --work-tree=/ co
    wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
    curl -fsSL https://mega.nz/keys/MEGA_signing.key | sudo apt-key add -"
graphical:
  dep: [libinput-gestures, spotify]
  pkg: [x11vnc, remmina, remmina-plugin-vnc, kdeconnect, i3, dmenu]
  cmd: |-
    sudo usermod -aG video $USER
    sudo usermod -aG plugdev $USER # are these needed? where to put them?
remote-access: {pkg: [openssh-server]}
bitwarden:
  pkg: [zip]
  cmd: |-
    wget -O ~/.local/bin/bitwarden 'https://vault.bitwarden.com/download/?app=cli&platform=linux'
    wget -O bw.zip 'https://vault.bitwarden.com/download/?app=cli&platform=linux'
    unzip -d ~/.local/bin bw.zip
    chmod +x ~/.local/bin/bw ~/.local/bin/bitwarden
    rm bw.zip
systemd-units:
  cmd: systemctl --user enable ~/.config/systemd/user/*
libinput-gestures:
  pkg: [xdotool, wmctrl, libinput-tools, zenity]
  cmd:
    - url=hub:bulletmark/libinput-gestures
    - *git-pre
    - sudo make install
    - *git-post
    - |-
      sudo usermod -aG input $user || true # is this only necessary on docker ubu?
      sudo ln -sf "${XDG_CONFIG_HOME:-$HOME/.config}/libinput-gestures/running.conf" "/etc/libinput-gestures.conf"
      libinput-gestures-setup autostart
tub: 
  dep: [tq]
  pkg: [kinit, kstart]
  cmd: |-
    url=updates.tubcloud.tu-berlin.de/
    latest=$(wget -O- $url | tq '.pricing-table-linux a' -a href)
    wget -O ~/.local/bin/tubCloud $url$latest
    chmod +x ~/.local/bin/tubCloud
tq:
  cmd: |-
    sudo pip3 install https://github.com/plainas/tq/zipball/stable
spotify:
  pkg: [curl]
  cmd: |-
    curl -sS https://download.spotify.com/debian/pubkey_0D811D58.gpg | sudo apt-key add -
    echo "deb http://repository.spotify.com stable non-free" | sudo tee /etc/apt/sources.list.d/spotify.list
    sudo apt-get update && sudo apt-get install -qy spotify-client
